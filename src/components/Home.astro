---
const logoImageSrc = "/assets/normalLogo.jpeg";
const menuItems = [
  { img: "/assets/menu1.jpg", name: "è±¬æ¢å­", price: "$180" },
  { img: "/assets/menu1.jpg", name: "é­šæ¢å­", price: "$120" },
  { img: "/assets/menu1.jpg", name: "é›æ¢å­", price: "$90" },
  { img: "/assets/menu1.jpg", name: "ç‰›æ¢å­", price: "$45" },
  { img: "/assets/menu1.jpg", name: "ç‹—æ¢å­", price: "$100000" },
];
---

<!-- logo and welcome -->
<div class="welcome-section">
  <img src={logoImageSrc} alt="æ­¡è¿åœ–ç‰‡" class="welcome-image" />
  <!-- å…¬å‘Šå€ -->
  <div class="announcement">
    <p>ğŸ”¥ æœ¬é€±å„ªæƒ ï¼šç¬¬äºŒä»½åŠåƒ¹ï¼ğŸ”¥</p>
  </div>
</div>

<!-- menu list -->
<div id="menu-section" class="menu-section">
  { menuItems.map((item, index) => (
    <div class="menu-item" data-name={item.name} data-price={item.price.replace('$', '')}>
      <img src={item.img} alt={item.name} class="menu-image" />
      <div class="menu-details">
        <h3 class="menu-name">{item.name}</h3>
        <p class="menu-price">{item.price}</p>
      </div>
    </div>
  )) }
</div>

<!-- ç·¨è¼¯ / æ–°å¢å…±ç”¨ modal -->
<div id="modal" class="modal hidden">
  <div class="modal-content modal-edit">
    <h2 id="modal-name">å“é …åç¨±</h2>
    <label>
      è¾£åº¦ï¼š
      <select id="spicy">
        <option value="ä¸è¾£">ä¸è¾£</option>
        <option value="å°è¾£">å°è¾£</option>
        <option value="ä¸­è¾£">ä¸­è¾£</option>
        <option value="å¤§è¾£">å¤§è¾£</option>
      </select>
    </label>
    <br />
    <label>
      ä»½æ•¸ï¼š
      <input type="number" id="quantity" min="1" value="1" />
    </label>
    <br />
    <button id="modal-confirm-btn">åŠ å…¥è³¼ç‰©è»Š</button>
    <button id="modal-cancel-btn">å–æ¶ˆ</button>
  </div>
</div>

<!-- çµå¸³é¡¯ç¤ºåœ¨ä¸‹æ–¹ -->
<div id="cart-section" class="cart-section">
  <span id="total-price">ç¸½é‡‘é¡ï¼š$0</span>
  <button class="checkout-btn">è³¼ç‰©è»Š</button>
</div>

<!-- Checkout Modal -->
<div id="checkout-modal" class="modal hidden">
  <div class="modal-content modal-checkout">
    <h2>è³¼ç‰©è»Š</h2>
    <div id="checkout-eachItems" class = "checkout-items"></div>
    <div id="checkout-total">ç¸½é‡‘é¡ï¼š$0</div>
    <button id="pay-btn">ä»˜æ¬¾</button>
    <button id="checkout-close">é—œé–‰</button>
  </div>
</div>

<!-- è¯çµ¡æ–¹å¼ -->
<div id="contact-section" class="contact-section">
  <h2>è¯çµ¡æˆ‘å€‘</h2>
  <p>é›»è©±ï¼š0987-654-321</p>
  <p>åœ°å€ï¼šå°åŒ—å¸‚ä¸­æ­£å€æŸè¡— 123 è™Ÿ</p>
  <p>é›»å­éƒµä»¶ï¼šcontact@tiaozilai.com</p>
</div>

<script>
  /*cart function*/
  interface MenuItem {
    img: string;
    name: string;
    price: number;
  }

  interface CartItem extends MenuItem {
    spicy: string;
    qty: number;
    total: number;
  }

  const confirmBtn = document.getElementById("modal-confirm-btn") as HTMLButtonElement;
  const cancelBtn = document.getElementById("modal-cancel-btn") as HTMLButtonElement;

  let currentItem: MenuItem | null = null;
  let cart: CartItem[] = [];
  let editIndex: number | null = null; // null è¡¨ç¤ºæ–°å¢ï¼Œé null è¡¨ç¤ºæ­£åœ¨ç·¨è¼¯å“ªä¸€ç­†

  
  document.querySelectorAll(".menu-item").forEach(el => {
    el.addEventListener("click", () => openModal(el as HTMLElement));
  });

  function openModal(el: HTMLElement) {
    const name = el.getAttribute("data-name")!;
    const price = parseInt(el.getAttribute("data-price")!, 10);

    currentItem = { img: "", name, price };
    editIndex = null; // æ–°å¢æ¨¡å¼
    document.getElementById("modal-name")!.innerText = name;
    confirmBtn.innerText = "åŠ å…¥è³¼ç‰©è»Š"; // æ–°å¢æ¨¡å¼æ–‡å­—

      // æ¯æ¬¡é–‹èµ·modaléƒ½æœƒé‡è£½æˆdefault option
    (document.getElementById("quantity") as HTMLInputElement).value = "1";
    (document.getElementById("spicy") as HTMLSelectElement).value = "ä¸è¾£";
    document.getElementById("modal")!.classList.remove("hidden");

    confirmBtn.onclick = addToCart;
    cancelBtn.onclick = closeModal;
  }

  function closeModal() {
    document.getElementById("modal")!.classList.add("hidden");
  }

  function updateCart() {
    const total = cart.reduce((sum, item) => sum + item.total, 0);
    (document.getElementById("total-price") as HTMLElement).innerText = "ç¸½é‡‘é¡ï¼š$" + total;
  }

  function addToCart() {
    const spicyEl = document.getElementById("spicy") as HTMLSelectElement | null;
    const qtyEl = document.getElementById("quantity") as HTMLInputElement | null;

    if (!spicyEl || !qtyEl || !currentItem) return;

    const spicy = spicyEl.value;
    const qty = parseInt(qtyEl.value, 10);
    const total = currentItem.price * qty;

    if (editIndex !== null) {
    // ç·¨è¼¯æ¨¡å¼ -> æ›´æ–°åŸæœ¬ cart
      cart[editIndex] = { ...currentItem, spicy, qty, total };
    } else {
      // æ–°å¢æ¨¡å¼
      cart.push({ ...currentItem, spicy, qty, total });
    }
    updateCart();
    renderCheckoutItems();

    // é‡ç½®ç·¨è¼¯ç‹€æ…‹
    editIndex = null;

    // é—œé–‰ modal ä¸¦å›åˆ° checkout æˆ–ä¸€èˆ¬é é¢
    document.getElementById("modal")!.classList.add("hidden");
    if (checkoutModal.classList.contains("hidden") === false) {
      checkoutModal.classList.remove("hidden"); // ç·¨è¼¯æ™‚å›åˆ° checkout
    }
  }

  /*checkout function*/
  const cartSection = document.getElementById("cart-section")!;
  const checkoutModal = document.getElementById("checkout-modal")!;
  const checkoutItems = document.getElementById("checkout-eachItems")!;
  const checkoutTotal = document.getElementById("checkout-total")!;
  const payBtn = document.getElementById("pay-btn")!;
  const checkoutClose = document.getElementById("checkout-close")!;

  function renderCheckoutItems() {
    checkoutItems.innerHTML = "";
    cart.forEach((item, index) => {
      const div = document.createElement("div");
      div.className = "checkout-item";
      div.innerHTML = `
        <div class="button-group">
          <button class="edit-btn">ç·¨è¼¯</button>
          <button class="delete-btn">åˆªé™¤</button>
        </div>
        <div class="item-info">
          <strong>${item.name}</strong> | è¾£åº¦: ${item.spicy} | æ•¸é‡: ${item.qty} | å°è¨ˆ: $${item.total}
        </div>
      `;
      // ç·¨è¼¯
      div.querySelector(".edit-btn")!.addEventListener("click", () => {
        checkoutModal.classList.add("hidden");
        openModalByCartItem(index);
      });
      // åˆªé™¤
      div.querySelector(".delete-btn")!.addEventListener("click", () => {
        cart.splice(index, 1);
        renderCheckoutItems();
        updateCart();
      });
      checkoutItems.appendChild(div);
    });

    const total = cart.reduce((sum, item) => sum + item.total, 0);
    checkoutTotal.innerText = "ç¸½é‡‘é¡ï¼š$" + total;
  }

  // ç”± checkout ç·¨è¼¯
  function openModalByCartItem(index: number) {
    const item = cart[index];
    currentItem = { ...item };
    editIndex = index; // ç·¨è¼¯æ¨¡å¼
    document.getElementById("modal-name")!.innerText = item.name;
    (document.getElementById("spicy") as HTMLSelectElement).value = item.spicy;
    (document.getElementById("quantity") as HTMLInputElement).value = String(item.qty);

    confirmBtn.innerText = "æ›´æ–°è³¼ç‰©è»Š"; // ç·¨è¼¯æ¨¡å¼æ–‡å­—
    cancelBtn.innerText = "é—œé–‰"; // ç·¨è¼¯æ¨¡å¼æ–‡å­—

    document.getElementById("modal")!.classList.remove("hidden");

    confirmBtn.onclick = () => {
      const spicyEl = document.getElementById("spicy") as HTMLSelectElement;
      const qtyEl = document.getElementById("quantity") as HTMLInputElement;
      const qty = parseInt(qtyEl.value, 10);
      const spicy = spicyEl.value;
      const total = currentItem!.price * qty;

      cart[editIndex!] = { ...currentItem!, spicy, qty, total };
      updateCart();
      renderCheckoutItems();

      // é—œé–‰ modal ä¸¦å›åˆ° checkout
      document.getElementById("modal")!.classList.add("hidden");
      checkoutModal.classList.remove("hidden");

      // é‡ç½®ç·¨è¼¯ç‹€æ…‹
      editIndex = null;
      confirmBtn.innerText = "åŠ å…¥è³¼ç‰©è»Š"; // ä¸‹æ¬¡å›åˆ°æ–°å¢æ¨¡å¼
      cancelBtn.innerText = "å–æ¶ˆ";
    };

    cancelBtn.onclick = () => {
      document.getElementById("modal")!.classList.add("hidden");
      checkoutModal.classList.remove("hidden"); // ç·¨è¼¯æ™‚æŒ‰é—œé–‰å›åˆ° checkout
      editIndex = null;
      confirmBtn.innerText = "åŠ å…¥è³¼ç‰©è»Š"; // é‡ç½®
      cancelBtn.innerText = "å–æ¶ˆ";
    };
  }

  // æ‰“é–‹çµå¸³è¦–çª—
  cartSection.querySelector(".checkout-btn")!.addEventListener("click", () => {
    renderCheckoutItems();
    checkoutModal.classList.remove("hidden");
  });
  // é—œé–‰çµå¸³è¦–çª—
  checkoutClose.addEventListener("click", () => checkoutModal.classList.add("hidden"));

</script>

<style is:global>
  .contact-section {
    padding: 5px;
    background: #eee;
    text-align: center;
    padding-bottom: 80px; /* é ç•™çµ¦ cart-section */
  }

  .contact-section h2 {
    font-size: 24px;
    margin-bottom: 15px;
  }

  .contact-section p {
    font-size: 18px;
    margin: 5px 0;
  }

  .menu-section {
    display: grid;
    grid-template-columns: repeat(2, 1fr); /* æ¯è¡Œ 2 æ¬„ */
    gap: 20px; /* æ¯å€‹ menu-item é–“è· */
    padding: 20px;
  }

  .menu-item {
    display: flex;
    align-items: center;
    background: #f9f9f9;
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }

  .menu-image {
    width: 100px;
    height: 100px;
    object-fit: cover;
    margin-right: 15px;
  }

  .menu-details {
    flex: 1;
    position: relative; /* è¨­å®šç›¸å°ä½ç½® */
  }

  .menu-name {
    font-size: 20px;
    font-weight: bold;
  }

  .menu-price {
    font-size: 18px;
    color: #d35400;
    position: absolute; /* è®“åƒ¹æ ¼å›ºå®šåœ¨ menu-details å…§éƒ¨ */
    bottom: 5px;
    right: 5px;
  }

  .welcome-section {
    position: relative; /* å›ºå®šåœ¨è¢å¹•ä¸Šæ–¹ */
    top: 0; /* ç¢ºä¿è²¼é½Šé ‚éƒ¨ */
    width: 100%; /* è®“å€å¡Šæ©«å‘å¡«æ»¿ */
    display: flex;
    align-items: center; /* è®“æ–‡å­—èˆ‡åœ–ç‰‡å‚ç›´å°é½Š */
    justify-content: center; /* è®“å…§å®¹å±…ä¸­ */
    gap: 0px; /* æ§åˆ¶æ¨™é¡Œèˆ‡åœ–ç‰‡çš„é–“è· */
    background-color: #ffffff; /* èƒŒæ™¯é¡è‰² */
    flex-wrap: wrap; /* è®“å…§å®¹åœ¨å°è¢å¹•ä¸Šè‡ªå‹•æ›è¡Œ */
  }

  .announcement {
    width: 100%;
    text-align: center;
    background-color: #ffeeba;
    color: #856404;
    padding: 10px;
    font-size: 16px;
    font-weight: bold;
    border-top: 1px solid #ffd966;
    border-bottom: 1px solid #ffd966;
  }

  .title,
  .subtitle {
    font-size: 2rem;
    font-weight: bold;
    color: #333;
    line-height: 40px; /* è®“æ–‡å­—é«˜åº¦èˆ‡åœ–ç‰‡ç›¸åŒ */
    white-space: nowrap; /* é˜²æ­¢æ›è¡Œ */
  }

  .welcome-image {
    width: 100px; /* å›ºå®šåœ–ç‰‡å¯¬åº¦ */
    height: 40px; /* ç¢ºä¿é«˜åº¦èˆ‡æ–‡å­—ä¸€è‡´ */
    object-fit: contain; /* è®“åœ–ç‰‡é©æ‡‰å¤§å°ä½†ä¸è£åˆ‡ */
  }

  /* Modal æ¨£å¼ */
  .modal {
    position: fixed;
    top: 0; left: 0; right:0; bottom:0;
    display: flex; justify-content: center; align-items: center;
    background: rgba(0,0,0,0.5);
    overflow: auto;
  }
  .modal.hidden { display: none; }

  /* æ–°å¢/ç·¨è¼¯ modal */
  .modal-edit {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;  /* æ–‡å­—ç½®ä¸­æ²’å•é¡Œ */
  }

  /* è³¼ç‰©è»Š modal */
  .modal-checkout {
    background: #fff;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    max-height: 400px;  /* å¯æ»¾å‹• */
    overflow-y: auto;
  }

  /* è³¼ç‰©è»Šå›ºå®šå€ */
  .cart-section {
    position: relative;
    bottom: 0; left: 0; right: 0;
    background: #fff;
    border-top: 2px solid #ddd;
    padding: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: env(safe-area-inset-bottom); /* é©é…æ‘ºç–Šè¢å¹•/æ‰‹æ©Ÿç€æµ· */
  }
  .checkout-btn {
    background: #ff6600; color: white;
    padding: 8px 15px; border: none; border-radius: 5px;
  }

  .checkout-item {
    padding: 15px;                     /* å…§è· */
    margin-bottom: 15px;               /* èˆ‡ä¸‹æ–¹æ ¼å­è·é›¢ */
    border-radius: 10px;               /* åœ“è§’ */
    background: #fff;                   /* èƒŒæ™¯è‰²å¯ä»¥ç”¨ç™½è‰²æˆ–æ¼¸å±¤ */
    box-shadow: 0 4px 8px rgba(0,0,0,0.15); /* é™°å½±è®“å®ƒæµ®èµ·ä¾† */
    border: 1px solid #ddd;            /* ç´°é‚Šæ¡† */
    position: relative;
  }

  .checkout-item .button-group {
    position: absolute;
    top: 5px;
    right: 5px;
    display: flex;
    gap: 5px;
  }

  .checkout-item .button-group button {
    padding: 3px 6px;
    font-size: 14px;
    border: none;
    border-radius: 3px;
    cursor: pointer;
  }

  .checkout-item .button-group .edit-btn {
    background-color: #3498db;
    color: white;
  }

  .checkout-item .button-group .delete-btn {
    background-color: #e74c3c;
    color: white;
  }

  .checkout-item .item-info {
    margin-top: 20px; /* é¿é–‹å³ä¸Šè§’æŒ‰éˆ• */
    font-size: 16px;
    line-height: 1;
  }

  @media screen and (max-width: 480px) {
    .welcome-section {
      flex-direction: row; /* æ‰‹æ©Ÿç‰ˆæ”¹ç‚ºç›´æ’ */
    }

    .title,
    .subtitle {
      font-size: 1.5rem;
    }

    .welcome-image {
      max-width: 50%; /* æ‰‹æ©Ÿç‰ˆçš„åœ–ç‰‡ç¨å¾®åŠ å¤§ */
    }

    .menu-list {
      width: 120px;
    }

    .checkout-item .edit-btn,
    .checkout-item .delete-btn {
      font-size: 12px;
      padding: 2px 5px;
    }
  }

  @media screen and (max-width: 600px) {
    .menu-section {
      grid-template-columns: 1fr; /* æ‰‹æ©Ÿç‰ˆï¼šå–®æ¬„é¡¯ç¤º */
    }
  }


  @media screen and (min-width: 768px) {
    .title,
    .subtitle {
      font-size: 2.5rem;
    }
  }
</style>
